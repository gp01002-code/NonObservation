<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‡ªæˆ‘è§€æ¸¬å„€ | è¢«è§€çœ‹çš„è‡ªæˆ‘èˆ‡ä¸»é«”é‡æ§‹</title>
    <style>
        :root {
            --bg-dark: #020205;
            --panel-bg: rgba(10, 10, 20, 0.85);
            --accent-mirror: #00d4ff; /* éšæ®µ1ï¼šé¡åƒè— */
            --accent-observation: #00ff88; /* éšæ®µ2ï¼šè§€æ¸¬ç¶  */
            --accent-simulacrum: #ff00ff; /* éšæ®µ3ï¼šæ“¬åƒç´« */
            --text-main: #e0e0e0;
            --font-mono: 'Courier New', monospace;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Inter', 'Microsoft JhengHei', sans-serif;
            background: var(--bg-dark);
            color: var(--text-main);
            height: 100vh;
            overflow: hidden;
            display: grid;
            grid-template-columns: 320px 1fr 320px;
            gap: 15px;
            padding: 15px;
        }

        /* é¢æ¿åŸºç¤æ¨£å¼ */
        .panel {
            background: var(--panel-bg);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            backdrop-filter: blur(10px);
        }

        h1 { font-size: 1.1rem; letter-spacing: 2px; margin-bottom: 20px; text-transform: uppercase; border-bottom: 1px solid rgba(255, 255, 255, 0.2); padding-bottom: 10px; }
        h2 { font-size: 0.8rem; color: #888; margin: 15px 0 10px 0; text-transform: uppercase; }

        /* éšæ®µé¸æ“‡å™¨ */
        .stage-control {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid transparent;
            transition: all 0.5s;
        }
        .stage-1 .stage-control { border-color: var(--accent-mirror); box-shadow: 0 0 15px rgba(0, 212, 255, 0.2); }
        .stage-2 .stage-control { border-color: var(--accent-observation); box-shadow: 0 0 15px rgba(0, 255, 136, 0.2); }
        .stage-3 .stage-control { border-color: var(--accent-simulacrum); box-shadow: 0 0 15px rgba(255, 0, 255, 0.2); }

        .stage-label { font-size: 0.9rem; font-weight: bold; margin-bottom: 10px; display: block; text-align: center; }

        input[type="range"] {
            width: 100%; height: 4px; border-radius: 2px; appearance: none; background: #333; outline: none; margin: 10px 0;
        }
        input[type="range"]::-webkit-slider-thumb {
            appearance: none; width: 16px; height: 16px; border-radius: 50%; background: #fff; cursor: pointer;
        }

        /* è¨Šè™Ÿæ»‘æ¡¿ */
        .eeg-group { margin-bottom: 12px; }
        .eeg-header { display: flex; justify-content: space-between; font-size: 0.75rem; color: #aaa; margin-bottom: 5px; }
        .eeg-val { color: #fff; font-weight: bold; }

        /* ä¸­å¤®ç•«å¸ƒ */
        .canvas-container {
            position: relative;
            background: #000;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        canvas { width: 100%; height: 100%; object-fit: cover; }

        .overlay-ui {
            position: absolute; top: 20px; left: 20px; pointer-events: none;
            font-family: var(--font-mono); font-size: 0.8rem;
        }
        .data-tag { background: rgba(0,0,0,0.7); padding: 4px 8px; border-radius: 4px; margin-bottom: 5px; border-left: 3px solid #fff; }

        /* æ—¥èªŒç³»çµ± */
        .log-container {
            flex-grow: 1;
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
            padding: 10px;
            font-family: var(--font-mono);
            font-size: 0.7rem;
            overflow-y: auto;
            border: 1px solid rgba(255,255,255,0.05);
        }
        .log-entry { margin-bottom: 8px; padding-bottom: 4px; border-bottom: 1px solid rgba(255,255,255,0.02); }
        .log-time { color: #555; margin-right: 5px; }
        .log-tag { font-weight: bold; margin-right: 5px; }

        button {
            width: 100%; padding: 12px; margin-top: 10px;
            background: transparent; border: 1px solid #444; color: #fff;
            border-radius: 6px; cursor: pointer; transition: 0.3s;
            text-transform: uppercase; font-size: 0.75rem; letter-spacing: 1px;
        }
        button:hover { background: #fff; color: #000; }
        button.active { background: #ff4757; border-color: #ff4757; }

        /* éšæ®µå°ˆå±¬é¡è‰² */
        .stage-1 .accent { color: var(--accent-mirror); }
        .stage-2 .accent { color: var(--accent-observation); }
        .stage-3 .accent { color: var(--accent-simulacrum); }
    </style>
</head>
<body class="stage-1">

    <!-- å·¦å´é¢æ¿ï¼šè…¦æ³¢èˆ‡æ¬ŠåŠ›æ§åˆ¶ -->
    <div class="panel">
        <h1>âš¡ ç³»çµ±è¨­ç½®</h1>
        
        <div class="stage-control">
            <span class="stage-label accent" id="stageName">éšæ®µ 1: å…·èº«é¡åƒ</span>
            <input type="range" id="stageSlider" min="1" max="3" step="1" value="1">
            <p style="font-size: 0.65rem; color: #666; text-align: center; line-height: 1.4;">
                èª¿æ•´éšæ®µä»¥è§€å¯Ÿä¸»é«”å¦‚ä½•åœ¨æ¼”ç®—æ³•ä¸­è¢«é€æ­¥é‡æ§‹ã€‚
            </p>
        </div>

        <h2>ç”Ÿç†è¨Šè™Ÿæ¨¡æ“¬ (EEG)</h2>
        <div id="eegSliders">
            <!-- å‹•æ…‹ç”Ÿæˆ -->
        </div>

        <h2>ç³»çµ±é‹ä½œ</h2>
        <button id="startBtn">â–¶ å•Ÿå‹•è§€æ¸¬å„€</button>
        <button id="resetBtn">âŸ³ é‡ç½®ä¸»é«”è³‡æ–™</button>

        <div style="margin-top: 20px; font-size: 0.7rem; color: #555; line-height: 1.5;">
            <strong>è«–æ–‡è¦é»ï¼š</strong><br>
            å¾ Merleau-Ponty çš„å…·èº«æ€§è½‰å‘ Baudrillard çš„è¶…çœŸå¯¦ã€‚
        </div>
    </div>

    <!-- ä¸­å¤®é¢æ¿ï¼šéè§€æ¸¬å ´åŸŸ -->
    <div class="panel canvas-container" id="viewport">
        <div class="overlay-ui">
            <div class="data-tag accent" id="statusTag">STATUS: IDLE</div>
            <div class="data-tag" id="latencyTag">LATENCY: 0ms</div>
            <div id="algorithmicTags"></div>
        </div>
        <canvas id="mainCanvas"></canvas>
    </div>

    <!-- å³å´é¢æ¿ï¼šç³»çµ±æ—¥èªŒèˆ‡åˆ†æ -->
    <div class="panel">
        <h1>ğŸ“Š æ¼”ç®—æ³•åˆ†æ</h1>
        
        <h2>æ½›åœ¨ç©ºé–“ç›£æ¸¬</h2>
        <div style="background: rgba(0,0,0,0.5); padding: 10px; border-radius: 8px; font-family: monospace; font-size: 0.7rem; margin-bottom: 15px;">
            <div style="display: flex; justify-content: space-between;"><span>å°é½Šåº¦:</span><span id="statAlignment">0%</span></div>
            <div style="display: flex; justify-content: space-between;"><span>ç†µå€¼ (Entropy):</span><span id="statEntropy">0.00</span></div>
            <div style="display: flex; justify-content: space-between;"><span>ä¸»é«”ä¸€è‡´æ€§:</span><span id="statSync">100%</span></div>
        </div>

        <h2>åŸ·è¡Œæ—¥èªŒ</h2>
        <div class="log-container" id="logBox">
            <div class="log-entry">ç³»çµ±å°±ç·’ï¼Œç­‰å¾…ä¸»é«”æ¥å…¥ã€‚</div>
        </div>

        <h2 style="margin-top: 20px;">ç•¶å‰å“²å­¸ç‹€æ…‹</h2>
        <p id="philosophyDesc" style="font-size: 0.75rem; color: #aaa; line-height: 1.6; font-style: italic;">
            å½±åƒä½œç‚ºä¸»é«”çš„å»¶ä¼¸ï¼Œåœ¨æ­¤éšæ®µï¼Œä½ èˆ‡å½±åƒä¿æŒè‘—ç¾è±¡å­¸å¼çš„çµ±ä¸€ã€‚
        </p>
    </div>

    <script>
        /**
         * è‡ªæˆ‘è§€æ¸¬å„€æ ¸å¿ƒé‚è¼¯
         * å‘¼æ‡‰è«–æ–‡ï¼šè¢«è§€çœ‹çš„è‡ªæˆ‘ï¼šç”Ÿæˆå¼å½±åƒæ™‚ä»£çš„éè§€æ¸¬èˆ‡ä¸»é«”é‡æ§‹
         */

        const config = {
            bands: [
                { id: 'delta', label: 'Delta', desc: 'æ·±å±¤æœ¬æˆ‘', val: 0.2 },
                { id: 'theta', label: 'Theta', desc: 'æ½›æ„è­˜æµ', val: 0.4 },
                { id: 'alpha', label: 'Alpha', desc: 'æ”¾é¬†æ„è­˜', val: 0.6 },
                { id: 'beta', label: 'Beta', desc: 'é‚è¼¯/ç„¦æ…®', val: 0.3 },
                { id: 'gamma', label: 'Gamma', desc: 'é«˜éšèªçŸ¥', val: 0.1 }
            ],
            stages: {
                1: { name: "éšæ®µ 1: å…·èº«é¡åƒ", desc: "ç¾è±¡å­¸è§€çœ‹ã€‚å½±åƒèˆ‡ä¸»é«”åŒæ­¥ï¼Œå¼·èª¿èº«é«”åœ–å¼çš„å®Œæ•´æ€§èˆ‡åå°„æ„Ÿã€‚", color: "#00d4ff", delay: 100, entropy: 0.1 },
                2: { name: "éšæ®µ 2: æ¼”ç®—æ³•éè§€æ¸¬", desc: "æ¬ŠåŠ›è¦è¨“ã€‚ç³»çµ±å°‡ä½ è½‰åŒ–ç‚ºç‰¹å¾µå‘é‡ï¼Œè§€çœ‹ä¸å†æ˜¯ç‚ºäº†ç†è§£ï¼Œè€Œæ˜¯ç‚ºäº†åˆ†é¡ã€‚", color: "#00ff88", delay: 3000, entropy: 0.5 },
                3: { name: "éšæ®µ 3: æ“¬åƒé‡æ§‹", desc: "è¶…çœŸå¯¦éšæ®µã€‚ç¢ç‰‡åŒ–çš„äº”å®˜æ‹¼è²¼å–ä»£äº†çœŸå¯¦è‡ªæˆ‘çš„çµ±ä¸€æ€§ã€‚æ“¬åƒä¸å†éœ€è¦åŸä»¶ã€‚", color: "#ff00ff", delay: 7000, entropy: 0.9 }
            }
        };

        const state = {
            isRunning: false,
            currentStage: 1,
            eeg: {},
            buffer: [],
            frameCount: 0
        };

        const canvas = document.getElementById('mainCanvas');
        const ctx = canvas.getContext('2d');
        const logBox = document.getElementById('logBox');

        // åˆå§‹åŒ–æ»‘æ¡¿
        function initUI() {
            const container = document.getElementById('eegSliders');
            config.bands.forEach(band => {
                state.eeg[band.id] = band.val;
                const div = document.createElement('div');
                div.className = 'eeg-group';
                div.innerHTML = `
                    <div class="eeg-header">
                        <span>${band.label} (${band.desc})</span>
                        <span class="eeg-val" id="val-${band.id}">${Math.floor(band.val * 100)}%</span>
                    </div>
                    <input type="range" id="slider-${band.id}" min="0" max="100" value="${band.val * 100}">
                `;
                container.appendChild(div);
                
                document.getElementById(`slider-${band.id}`).oninput = (e) => {
                    const v = e.target.value / 100;
                    state.eeg[band.id] = v;
                    document.getElementById(`val-${band.id}`).textContent = e.target.value + '%';
                };
            });

            document.getElementById('stageSlider').oninput = (e) => {
                const s = parseInt(e.target.value);
                setStage(s);
            };

            document.getElementById('startBtn').onclick = toggleSystem;
            document.getElementById('resetBtn').onclick = resetSystem;
        }

        function setStage(s) {
            state.currentStage = s;
            document.body.className = `stage-${s}`;
            const data = config.stages[s];
            document.getElementById('stageName').textContent = data.name;
            document.getElementById('philosophyDesc').textContent = data.desc;
            document.getElementById('latencyTag').textContent = `LATENCY: ${data.delay}ms`;
            addLog(`ä¸»é«”é‡æ§‹ï¼šé€²å…¥ ${data.name}`, 'æ¬ŠåŠ›è½‰å‘');
        }

        function addLog(msg, tag = 'ç³»çµ±') {
            const time = new Date().toLocaleTimeString().split(' ')[0];
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            entry.innerHTML = `<span class="log-time">${time}</span><span class="log-tag accent">[${tag}]</span> ${msg}`;
            logBox.prepend(entry);
            if(logBox.children.length > 20) logBox.lastChild.remove();
        }

        function toggleSystem() {
            state.isRunning = !state.isRunning;
            const btn = document.getElementById('startBtn');
            btn.textContent = state.isRunning ? "â¸ åœæ­¢è§€æ¸¬" : "â–¶ å•Ÿå‹•è§€æ¸¬å„€";
            btn.classList.toggle('active', state.isRunning);
            document.getElementById('statusTag').textContent = state.isRunning ? "STATUS: OBSERVING" : "STATUS: IDLE";
            addLog(state.isRunning ? "è§€æ¸¬å•Ÿå‹•ï¼šæ­£åœ¨è®€å–ä¸»é«”è…¦æ³¢..." : "è§€æ¸¬çµ‚æ­¢");
        }

        function resetSystem() {
            state.buffer = [];
            addLog("ä¸»é«”ç·©è¡å€å·²æ¸…é™¤ã€‚è³‡æ–™åŒ–éç¨‹é‡ç½®ã€‚", "é‡ç½®");
        }

        // æ ¸å¿ƒæ¸²æŸ“å¾ªç’°
        function loop() {
            if (state.isRunning) {
                state.frameCount++;
                
                // æ¨¡æ“¬æ•¸æ“šå»¶é² (éè§€æ¸¬æ©Ÿåˆ¶)
                const delayFrames = Math.floor(config.stages[state.currentStage].delay / 16);
                state.buffer.push({...state.eeg});
                if (state.buffer.length > delayFrames + 1) state.buffer.shift();
                
                const activeEEG = state.buffer[0] || state.eeg;
                render(activeEEG);
                updateStats();
                
                // éš¨æ©Ÿæ—¥èªŒ (å‘¼æ‡‰è«–æ–‡)
                if (state.frameCount % 240 === 0) {
                    const stageMsgs = {
                        1: ["é¡åƒä¸€è‡´æ€§é©—è­‰é€šéã€‚", "å…·èº«åé¥‹ç©©å®šã€‚", "ç¾è±¡å­¸é€£çµä¸­..."],
                        2: ["è³‡æ–™åŒ–è½‰æ›ï¼šä¸»é«”é™ç¶­è‡³ç‰¹å¾µé»ã€‚", "æ­£åœ¨è¨ˆç®—çµ±è¨ˆåˆç†æ€§ã€‚", "éè§€æ¸¬é‚è¼¯å•Ÿå‹•ï¼šç•¥éæ„Ÿå®˜ç´°ç¯€ã€‚"],
                        3: ["æ“¬åƒå·²åå™¬çœŸå¯¦ã€‚", "ç™¼ç¾è¶…çœŸå¯¦å™ªé»ã€‚", "ä¸»é«”é‡æ§‹ï¼šä¸å†ä¾è³´åŸå§‹æ¨™è¨˜ã€‚"]
                    };
                    const msg = stageMsgs[state.currentStage][Math.floor(Math.random() * 3)];
                    addLog(msg, "æ¼”ç®—æ³•");
                }
            }
            requestAnimationFrame(loop);
        }

        function render(eeg) {
            const w = canvas.width;
            const h = canvas.height;
            const t = performance.now() * 0.001;

            // åŸºç¤èƒŒæ™¯æ·¡åŒ– (æ®˜å½±æ•ˆæœé«”ç¾æ™‚é–“æµå‹•)
            ctx.fillStyle = `rgba(0, 0, 0, ${state.currentStage === 1 ? 0.2 : 0.05})`;
            ctx.fillRect(0, 0, w, h);

            ctx.save();
            ctx.translate(w/2, h/2);

            if (state.currentStage === 1) {
                // éšæ®µ 1ï¼šæµå‹•çš„å…·èº«é¡åƒ
                drawMirror(ctx, eeg, t);
            } else if (state.currentStage === 2) {
                // éšæ®µ 2ï¼šè³‡æ–™åŒ–çš„çŸ©é™£è§€æ¸¬
                drawDataObservation(ctx, eeg, t);
            } else if (state.currentStage === 3) {
                // éšæ®µ 3ï¼šäº”å®˜ç¢ç‰‡æ‹¼è²¼ (æ“¬åƒ)
                drawSimulacrumCollage(ctx, eeg, t);
            }

            ctx.restore();
        }

        // --- ç¹ªåœ–å­ç¨‹åº ---

        function drawMirror(ctx, eeg, t) {
            const color = config.stages[1].color;
            ctx.strokeStyle = color;
            ctx.lineWidth = 2;
            ctx.beginPath();
            const points = 60 + eeg.alpha * 100;
            for(let i=0; i <= points; i++) {
                const angle = (i / points) * Math.PI * 2;
                const r = 150 + Math.sin(angle * 5 + t) * (eeg.beta * 50);
                const x = Math.cos(angle) * r;
                const y = Math.sin(angle) * r;
                i === 0 ? ctx.moveTo(x, y) : ctx.lineTo(x, y);
            }
            ctx.closePath();
            ctx.stroke();
            
            // è¼•å¾®çš„å…‰æšˆ
            ctx.shadowBlur = 15;
            ctx.shadowColor = color;
        }

        function drawDataObservation(ctx, eeg, t) {
            const color = config.stages[2].color;
            ctx.strokeStyle = color;
            ctx.fillStyle = color;
            const size = 300;
            
            // ç¹ªè£½æƒæç¶²æ ¼ (è¦è¨“ç¤¾æœƒçš„æ¨™å°º)
            ctx.lineWidth = 0.5;
            for(let i = -size; i <= size; i += 40) {
                ctx.beginPath(); ctx.moveTo(i, -size); ctx.lineTo(i, size); ctx.stroke();
                ctx.beginPath(); ctx.moveTo(-size, i); ctx.lineTo(size, i); ctx.stroke();
            }

            // ç¹ªè£½ç‰¹å¾µæŠ“å–é»
            const nodes = 8;
            for(let i=0; i<nodes; i++) {
                const x = Math.sin(t + i) * size * eeg.theta;
                const y = Math.cos(t * 0.5 + i) * size * eeg.delta;
                ctx.beginPath();
                ctx.arc(x, y, 4, 0, Math.PI*2);
                ctx.fill();
                ctx.strokeRect(x-10, y-10, 20, 20);
                
                ctx.font = "8px monospace";
                ctx.fillText(`FEATURE_ID: ${Math.floor(x+y)}`, x+15, y);
            }
        }

        /**
         * éšæ®µ 3 æ ¸å¿ƒï¼šæ“¬åƒé‡æ§‹ (äº”å®˜æ‹¼è²¼)
         * å‘¼æ‡‰è«–æ–‡ï¼šä¸ä½¿ç”¨å¤–éƒ¨ç…§ç‰‡ï¼Œè€Œæ˜¯ç”¨ Canvas ç¹ªè£½ã€Œæ•¸ä½åŒ–å™¨å®˜ã€ä¸¦éš¨æ©Ÿæ‹¼æ¹Š
         */
        function drawSimulacrumCollage(ctx, eeg, t) {
            const gridSize = 4;
            const cellSize = 120;
            const color = config.stages[3].color;

            for(let i = -gridSize/2; i < gridSize/2; i++) {
                for(let j = -gridSize/2; j < gridSize/2; j++) {
                    // æ ¹æ“šè…¦æ³¢äº‚æ•¸æ±ºå®šè©²æ ¼é¡¯ç¤ºä»€éº¼ã€Œæ“¬åƒå™¨å®˜ã€
                    const entropy = Math.random();
                    const x = i * cellSize + Math.sin(t + i) * 10;
                    const y = j * cellSize + Math.cos(t + j) * 10;

                    ctx.save();
                    ctx.translate(x, y);
                    ctx.rotate(Math.sin(t + i*j) * eeg.gamma);
                    
                    if (entropy > 0.7) {
                        drawFragmentEye(ctx, color, eeg);
                    } else if (entropy > 0.4) {
                        drawFragmentNose(ctx, color, eeg);
                    } else {
                        drawFragmentMouth(ctx, color, eeg);
                    }
                    
                    // é‚Šæ¡† (è³‡æ–™ç¢ç‰‡çš„é‚Šç•Œ)
                    ctx.strokeStyle = `rgba(255, 0, 255, ${0.1 + eeg.beta * 0.4})`;
                    ctx.strokeRect(-cellSize/2, -cellSize/2, cellSize, cellSize);
                    ctx.restore();
                }
            }
        }

        // å™¨å®˜ç¢ç‰‡ç¹ªè£½ (æŠ½è±¡åŒ–ã€çµ±è¨ˆåŒ–çš„å™¨å®˜)
        function drawFragmentEye(ctx, color, eeg) {
            ctx.strokeStyle = color;
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.ellipse(0, 0, 30, 15 * eeg.alpha, 0, 0, Math.PI * 2);
            ctx.stroke();
            ctx.fillStyle = "#fff";
            ctx.beginPath();
            ctx.arc(Math.sin(performance.now()*0.01)*5, 0, 8, 0, Math.PI*2);
            ctx.fill();
        }

        function drawFragmentNose(ctx, color, eeg) {
            ctx.strokeStyle = color;
            ctx.beginPath();
            ctx.moveTo(-10, -20);
            ctx.lineTo(0, 10);
            ctx.lineTo(10, 10);
            ctx.stroke();
        }

        function drawFragmentMouth(ctx, color, eeg) {
            ctx.fillStyle = color;
            ctx.beginPath();
            ctx.ellipse(0, 10, 25, 10 * eeg.theta, 0, 0, Math.PI);
            ctx.fill();
        }

        function updateStats() {
            const s = state.currentStage;
            document.getElementById('statAlignment').textContent = `${Math.floor(100 - s * 30 + Math.random()*10)}%`;
            document.getElementById('statEntropy').textContent = (config.stages[s].entropy + Math.random()*0.1).toFixed(2);
            document.getElementById('statSync').textContent = `${Math.floor(100 / s)}%`;
        }

        function resize() {
            canvas.width = document.getElementById('viewport').clientWidth;
            canvas.height = document.getElementById('viewport').clientHeight;
        }

        window.addEventListener('resize', resize);
        window.onload = () => {
            initUI();
            resize();
            setStage(1);
            loop();
        };

    </script>
</body>
</html>
